# Copyright (c) 2019 SolarWinds, LLC.
# All rights reserved.

version: "2.1"

#########################################################################################################
#
# docker-compose to set up containers to run tests
#
# used by
# > rake docker
# > rake docker_tests
#
########################################################################################################

x-swo-shared: &swo-shared
  mem_limit: 1G
  logging:
    options:
      max-file: "1"
      max-size: "100m"
  ports:
    - "3000"
  stdin_open: true
  tty: true
  working_dir: /code/ruby-solarwinds
  privileged: true

services:
  ruby_sw_apm_debian_2.7.5:
    container_name: ruby_sw_apm_debian_27
    image: ruby:2.7.5-buster
    hostname: docker.swo.ubuntu
    << : *swo-shared
    volumes:
      - ../:/code/ruby-solarwinds
    environment:
      SW_APM_HOSTNAME_ALIAS: "SWO_RUBY_UBUNTU"

  ruby_sw_apm_debian_3.0.3:
    container_name: ruby_sw_apm_debian_30
    image: ruby:3.0.6-buster
    hostname: docker.swo.ubuntu
    << : *swo-shared
    volumes:
      - ../:/code/ruby-solarwinds
    environment:
      SW_APM_HOSTNAME_ALIAS: "SWO_RUBY_UBUNTU"

  ruby_sw_apm_debian_3.1.0:
    container_name: ruby_sw_apm_debian_31
    image: ruby:3.1.0-bullseye
    hostname: docker.swo.ubuntu
    << : *swo-shared
    volumes:
      - ../:/code/ruby-solarwinds
    environment:
      SW_APM_HOSTNAME_ALIAS: "SWO_RUBY_UBUNTU"

  ruby_sw_apm_debian_3.2.2:
    container_name: ruby_sw_apm_debian_32
    image: ruby:3.2.2-bullseye
    hostname: docker.swo.ubuntu
    << : *swo-shared
    volumes:
      - ../:/code/ruby-solarwinds
    environment:
      SW_APM_HOSTNAME_ALIAS: "SWO_RUBY_UBUNTU"

  ruby_sw_apm_ubuntu:
    container_name: ruby_sw_apm_ubuntu
    image: ubuntu:22.04
    hostname: docker.swo.ubuntu
    << : *swo-shared
    volumes:
      - ../:/code/ruby-solarwinds
    environment:
      SW_APM_HOSTNAME_ALIAS: "SWO_RUBY_UBUNTU"

  ruby_sw_apm_alpine:
    container_name: ruby_sw_apm_alpine
    image: alpine:3.17
    hostname: docker.swo.alpine
    <<: *swo-shared
    volumes:
      - ../:/code/ruby-solarwinds
    environment:
      SW_APM_HOSTNAME_ALIAS: "SWO_RUBY_ALPINE"

  ruby_sw_apm_debian:
    container_name: ruby_sw_apm_debian
    image: debian:bullseye
    hostname: docker.swo.debian
    << : *swo-shared
    volumes:
      - ../:/code/ruby-solarwinds
    environment:
      SW_APM_HOSTNAME_ALIAS: "SWO_RUBY_DEBIAN"

  ruby_sw_apm_amazonlinux:
    container_name: ruby_sw_apm_amazonlinux
    image: amazonlinux:2023
    hostname: docker.swo.amazonlinux
    << : *swo-shared
    volumes:
      - ../:/code/ruby-solarwinds
    environment:
      SW_APM_HOSTNAME_ALIAS: "SWO_RUBY_AMAZONLINUX"

  ruby_sw_apm_ubuntu_development:
    container_name: ruby_sw_apm_ubuntu_development
    image: ruby_sw_apm_ubuntu_development
    build:
      context: .
      dockerfile: Dockerfile
    hostname: docker.swo.ubuntu.development
    << : *swo-shared
    volumes:
      - ../:/code/ruby-solarwinds
    environment:
      SW_APM_HOSTNAME_ALIAS: "SWO_RUBY_UBUNTU_DEVELOPMENT"
      OBOE_STAGING: "true"
